
// const examData = [{
//     project_th: "ระบบวิเคราะห์ข้อมูลการขายสำหรับธุรกิจ SME",
//     project_en: "Sales Data Analytics System for SMEs",
//     start_date: "2025-09-01",
//     end_date: "2025-09-01",
//     status: "รอประเมิน",
//     students: [{
//         name: "นายธนพล สุขใจ",
//         id: "651234567-8"
//     }, {
//         name: "นางสาวจิราพร มีชัย",
//         id: "651234567-9"
//     }],
//     committee: [{
//         name: "ผศ.ดร.นิติการ นาคเจือทอง",
//         role: "กรรมการ",
//         objective_remark: "วัตถุประสงค์กว้างเกินไป ควรระบุให้ชัดเจนขึ้นว่าต้องการวิเคราะห์ข้อมูลด้านใดเป็นพิเศษ",
//         scope_remark: "ขอบเขตของระบบควรจำกัดให้แคบลง เช่น จำกัดเฉพาะข้อมูลการขายรายเดือนในจังหวัดหนึ่ง"
//     }, {
//         name: "รศ.ดร.ชลธิชา สุขเกษม",
//         role: "ประธาน",
//         objective_remark: "วัตถุประสงค์ชัดเจน แต่ควรเพิ่มเป้าหมายเชิงปริมาณ",
//         scope_remark: "ขอบเขตครอบคลุมดีแล้ว"
//     }, {
//         name: "ผศ.พงษ์ศักดิ์ รุ่งเรือง",
//         role: "กรรมการ",
//         objective_remark: "",
//         scope_remark: "ควรตรวจสอบความถูกต้องของข้อมูลที่ใช้ในการทดสอบระบบ"
//     }]
// }, {
//     project_th: "แอปพลิเคชันแนะนำร้านอาหารโดยใช้ AI",
//     project_en: "AI-Powered Restaurant Recommendation Application",
//     start_date: "2025-09-08",
//     end_date: "2025-09-08",
//     status: "ผ่านแบบแก้ไข",
//     students: [{
//         name: "นายวรวุฒิ รักษาพงษ์",
//         id: "643456789-0"
//     }],
//     committee: [{
//         name: "ผศ.ดร.นิติการ นาคเจือทอง",
//         role: "กรรมการ",
//         objective_remark: "ต้องปรับปรุงความแม่นยำของโมเดล AI ให้ดีขึ้น",
//         scope_remark: "การออกแบบ UI/UX ยังไม่เป็นมิตรกับผู้ใช้"
//     }, {
//         name: "อ.กฤษดา เก่งจริง",
//         role: "ประธาน",
//         objective_remark: "วัตถุประสงค์ต้องเชื่อมโยงกับปัญหาที่ชัดเจน",
//         scope_remark: "ควรเพิ่มข้อมูลร้านอาหารในฐานข้อมูลให้มีความหลากหลาย"
//     }, {
//         name: "รศ.อัจฉรา มีคุณธรรม",
//         role: "กรรมการ",
//         objective_remark: "วัตถุประสงค์ดี แต่การนำเสนอขาดความน่าสนใจ",
//         scope_remark: ""
//     }]
// }, {
//     project_th: "ระบบบริหารจัดการการเกษตรอัจฉริยะ",
//     project_en: "Smart Agriculture Management System",
//     start_date: "2025-09-15",
//     end_date: "2025-09-15",
//     status: "ไม่ผ่านการสอบหัวข้อโครงงาน",
//     students: [{
//         name: "นายวิโรจน์ แสนดี",
//         id: "647890123-4"
//     }, {
//         name: "นายสุชาติ มั่งคั่ง",
//         id: "647890123-5"
//     }],
//     committee: [{
//         name: "รศ.ดร.มานะ รักชาติ",
//         role: "ประธาน",
//         objective_remark: "หัวข้อกว้างเกินไป ขาดความชัดเจนของวัตถุประสงค์",
//         scope_remark: "ขอบเขตการทำงานของระบบไม่ชัดเจน"
//     }, {
//         name: "ผศ.ดร.นิติการ นาคเจือทอง",
//         role: "กรรมการ",
//         objective_remark: "วัตถุประสงค์ไม่สอดคล้องกับเทคโนโลยีที่เลือกใช้",
//         scope_remark: "นักศึกษายังขาดความเข้าใจในหลักการพื้นฐานที่เกี่ยวข้อง"
//     }, {
//         name: "ดร.วรรณภา พิทักษ์ไทย",
//         role: "กรรมการ",
//         objective_remark: "ควรปรับปรุงวัตถุประสงค์ให้มีความท้าทายมากขึ้น",
//         scope_remark: "ต้องมีการกำหนดขอบเขตของเซ็นเซอร์และอุปกรณ์ที่ใช้ให้ชัดเจน"
//     }]
// }, {
//     project_th: "การพัฒนาระบบการเรียนรู้ด้วยตนเองสำหรับนักศึกษา",
//     project_en: "Development of a Self-learning System for Students",
//     start_date: "2025-09-22",
//     end_date: "2025-09-22",
//     status: "รอประเมิน",
//     students: [{
//         name: "นายสมชาย เจริญสุข",
//         id: "644567890-1"
//     }],
//     committee: [{
//         name: "ดร.ไพโรจน์ อิ่มเอิบ",
//         role: "ประธาน",
//         objective_remark: "วัตถุประสงค์ดี แต่ควรเพิ่มความน่าสนใจในตัวอย่างการใช้งาน",
//         scope_remark: "แนะนำให้ทำแบบสอบถามเพื่อวัดผลการใช้งานจริงจากกลุ่มตัวอย่าง"
//     }, {
//         name: "รศ.ดร.มาลี อารีสุข",
//         role: "กรรมการ",
//         objective_remark: "",
//         scope_remark: ""
//     }, {
//         name: "ผศ.ดร.นิติการ นาคเจือทอง",
//         role: "กรรมการ",
//         objective_remark: "",
//         scope_remark: ""
//     }]
// }, {
//     project_th: "ระบบจัดการตารางเรียนอัตโนมัติ",
//     project_en: "Automated Class Scheduling System",
//     start_date: "2025-09-25",
//     end_date: "2025-09-25",
//     status: "ผ่านการสอบหัวข้อโครงงาน",
//     students: [{
//         name: "นางสาวศิริพร ใจดี",
//         id: "652345678-9"
//     }],
//     committee: [{
//         name: "รศ.ดร.ชลธิชา สุขเกษม",
//         role: "ประธาน",
//         objective_remark: "",
//         scope_remark: ""
//     }, {
//         name: "ผศ.ดร.นิติการ นาคเจือทอง",
//         role: "กรรมการ",
//         objective_remark: "",
//         scope_remark: ""
//     }]
// }];
const examData = [{
    project_th: "ระบบวิเคราะห์ข้อมูลการขายสำหรับธุรกิจ SME",
    project_en: "Sales Data Analytics System for SMEs",
    start_date: "2025-09-01",
    end_date: "2025-09-01",
    status: "รอประเมิน",
    students: [{
        name: "นายศตวรรษ บัวผัน",
        id: "6806022510581"
    }, {
        name: "นายไกรกูล แสงบุตรดี",
        id: "6806022510599"
    }],
    committee: [{
        name: "ผศ.ดร.นิติการ นาคเจือทอง",
        role: "กรรมการ",
        objective_remark: "วัตถุประสงค์กว้างเกินไป ควรระบุให้ชัดเจนขึ้นว่าต้องการวิเคราะห์ข้อมูลด้านใดเป็นพิเศษ",
        scope_remark: "ขอบเขตของระบบควรจำกัดให้แคบลง เช่น จำกัดเฉพาะข้อมูลการขายรายเดือนในจังหวัดหนึ่ง"
    }, {
        name: "ผศ.นพดล บูรณ์กุศล",
        role: "ประธาน",
        objective_remark: "วัตถุประสงค์ชัดเจน แต่ควรเพิ่มเป้าหมายเชิงปริมาณ",
        scope_remark: "ขอบเขตครอบคลุมดีแล้ว"
    }, {
        name: "ผศ.พีระศักดิ์ เสรีกุล",
        role: "กรรมการ",
        objective_remark: "",
        scope_remark: "ควรตรวจสอบความถูกต้องของข้อมูลที่ใช้ในการทดสอบระบบ"
    }, {
        name: "อ.ดร.ศิรินทรา แว่วศรี",
        role: "กรรมการ",
        objective_remark: "",
        scope_remark: ""
    }]
}, {
    project_th: "แอปพลิเคชันแนะนำร้านอาหารโดยใช้ AI",
    project_en: "AI-Powered Restaurant Recommendation Application",
    start_date: "2025-09-08",
    end_date: "2025-09-08",
    status: "ผ่านแบบแก้ไข",
    students: [{
        name: "นายขรรค์ชัย ลิ้มประเสริฐ",
        id: "6806022510033"
    }],
    committee: [{
        name: "ผศ.ดร.นิติการ นาคเจือทอง",
        role: "กรรมการ",
        objective_remark: "ต้องปรับปรุงความแม่นยำของโมเดล AI ให้ดีขึ้น",
        scope_remark: "การออกแบบ UI/UX ยังไม่เป็นมิตรกับผู้ใช้"
    }, {
        name: "อ.ดร.กาญจน ณ ศรีธะ",
        role: "ประธาน",
        objective_remark: "วัตถุประสงค์ต้องเชื่อมโยงกับปัญหาที่ชัดเจน",
        scope_remark: "ควรเพิ่มข้อมูลร้านอาหารในฐานข้อมูลให้มีความหลากหลาย"
    }, {
        name: "รศ.ดร.อนิราช มิ่งขวัญ",
        role: "กรรมการ",
        objective_remark: "วัตถุประสงค์ดี แต่การนำเสนอขาดความน่าสนใจ",
        scope_remark: ""
    }, {
        name: "ผศ.พีระศักดิ์ เสรีกุล",
        role: "กรรมการ",
        objective_remark: "ควรทบทวนการนำเสนอให้กระชับและตรงประเด็นมากขึ้น",
        scope_remark: "ควรมีการสำรวจความต้องการของผู้ใช้ก่อนเริ่มพัฒนา"
    }]
}, {
    project_th: "ระบบบริหารจัดการการเกษตรอัจฉริยะ",
    project_en: "Smart Agriculture Management System",
    start_date: "2025-09-15",
    end_date: "2025-09-15",
    status: "ไม่ผ่านการสอบหัวข้อโครงงาน",
    students: [{
        name: "นายนันทวัฒน์ นันทวิสาร",
        id: "6806022510050"
    }, {
        name: "นายกัณติกรณ์ สรสุริยวงษ์",
        id: "6806022510068"
    }],
    committee: [{
        name: "อ.ดร.ศิรินทรา แว่วศรี",
        role: "ประธาน",
        objective_remark: "หัวข้อกว้างเกินไป ขาดความชัดเจนของวัตถุประสงค์",
        scope_remark: "ขอบเขตการทำงานของระบบไม่ชัดเจน"
    }, {
        name: "ผศ.ดร.นิติการ นาคเจือทอง",
        role: "กรรมการ",
        objective_remark: "วัตถุประสงค์ไม่สอดคล้องกับเทคโนโลยีที่เลือกใช้",
        scope_remark: "นักศึกษายังขาดความเข้าใจในหลักการพื้นฐานที่เกี่ยวข้อง"
    }, {
        name: "รศ.ดร.ยุพิน สรรพคุณ",
        role: "กรรมการ",
        objective_remark: "ควรปรับปรุงวัตถุประสงค์ให้มีความท้าทายมากขึ้น",
        scope_remark: "ต้องมีการกำหนดขอบเขตของเซ็นเซอร์และอุปกรณ์ที่ใช้ให้ชัดเจน"
    }, {
        name: "ผศ.นพดล บูรณ์กุศล",
        role: "กรรมการ",
        objective_remark: "ควรปรับปรุงวัตถุประสงค์ให้มีความท้าทายมากขึ้น โดยอาจเพิ่มฟีเจอร์ที่ซับซ้อน เช่น การใช้ Machine Learning ในการวิเคราะห์ข้อมูล",
        scope_remark: "ขอบเขตของโครงการยังกว้างเกินไป ควรจำกัดขอบเขตการทำงานให้ชัดเจน เพื่อให้สามารถพัฒนาได้สำเร็จภายในระยะเวลาที่กำหนด"
    }]
}, {
    project_th: "การพัฒนาระบบการเรียนรู้ด้วยตนเองสำหรับนักศึกษา",
    project_en: "Development of a Self-learning System for Students",
    start_date: "2025-09-22",
    end_date: "2025-09-22",
    status: "รอประเมิน",
    students: [{
        name: "นายกณวรรธน์ เดชแสง",
        id: "6806022510076"
    }],
    committee: [{
        name: "ผศ.ดร.บีสุดา ดาวเรือง",
        role: "ประธาน",
        objective_remark: "วัตถุประสงค์ดี แต่ควรเพิ่มความน่าสนใจในตัวอย่างการใช้งาน",
        scope_remark: "แนะนำให้ทำแบบสอบถามเพื่อวัดผลการใช้งานจริงจากกลุ่มตัวอย่าง"
    }, {
        name: "ผศ.จสต.นพเก้า ทองใบ",
        role: "กรรมการ",
        objective_remark: "",
        scope_remark: ""
    }, {
        name: "ผศ.ดร.นิติการ นาคเจือทอง",
        role: "กรรมการ",
        objective_remark: "",
        scope_remark: ""
    }, {
        name: "รศ.ดร.อนิราช มิ่งขวัญ",
        role: "กรรมการ",
        objective_remark: "",
        scope_remark: ""
    }]
}, {
    project_th: "ระบบจัดการตารางเรียนอัตโนมัติ",
    project_en: "Automated Class Scheduling System",
    start_date: "2025-09-25",
    end_date: "2025-09-25",
    status: "ผ่านการสอบหัวข้อโครงงาน",
    students: [{
        name: "นางสาวกนกวรรณ ศรีประไชย",
        id: "6806022510041"
    }],
    committee: [{
        name: "รศ.ดร.อนิราช มิ่งขวัญ",
        role: "ประธาน",
        objective_remark: "",
        scope_remark: ""
    }, {
        name: "ผศ.สมชัย เชียงพงศ์พันธุ์",
        role: "กรรมการ",
        objective_remark: "",
        scope_remark: ""
    }, {
        name: "ผศ.ดร.นิติการ นาคเจือทอง",
        role: "กรรมการ",
        objective_remark: "ต้องปรับปรุงการนำเสนอให้สั้นและกระชับ",
        scope_remark: "การวิเคราะห์ความต้องการของผู้ใช้ยังไม่สมบูรณ์"
    }, {
        name: "ผศ.พีระศักดิ์ เสรีกุล",
        role: "กรรมการ",
        objective_remark: "",
        scope_remark: ""
    }]
}];
const tableBody = document.getElementById('evaluation-table-body');
const evaluationModal = document.getElementById('evaluationModal');
const remarkModal = document.getElementById('remarkModal');
let currentExamIndex = -1;

const formatDate = (dateString) => {
    const options = {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
    };
    return new Date(dateString).toLocaleDateString('th-TH', options);
};

const updateSummaryCards = () => {
    const counts = examData.reduce((acc, exam) => {
        const status = exam.status;
        if (status === 'รอประเมิน') acc.pending++;
        else if (status === 'ผ่านการสอบหัวข้อโครงงาน') acc.pass++;
        else if (status === 'ผ่านแบบแก้ไข') acc.revise++;
        else if (status === 'ไม่ผ่านการสอบหัวข้อโครงงาน') acc.fail++;
        return acc;
    }, {
        pending: 0,
        pass: 0,
        revise: 0,
        fail: 0
    });

    document.getElementById('summary-pending').textContent = counts.pending;
    document.getElementById('summary-pass').textContent = counts.pass;
    document.getElementById('summary-revise').textContent = counts.revise;
    document.getElementById('summary-fail').textContent = counts.fail;
};

const renderTable = (filteredData = examData) => {
    tableBody.innerHTML = '';
    filteredData.forEach((exam, index) => {
        let statusClass = '';
        let buttonHtml = '';

        const originalIndex = examData.findIndex(item => item === exam);

        switch (exam.status) {
            case 'ผ่านการสอบหัวข้อโครงงาน':
                statusClass = 'bg-green-100 text-green-800';
                break;
            case 'ผ่านแบบแก้ไข':
                statusClass = 'bg-yellow-100 text-yellow-800';
                // ใช้ class btn-evaluate เพื่อให้เป็นสีน้ำเงิน
                buttonHtml = `<button onclick="openRemarkModal(${originalIndex})" class="btn-evaluate">ดูหมายเหตุ</button>`;
                break;
            case 'ไม่ผ่านการสอบหัวข้อโครงงาน':
                statusClass = 'bg-red-100 text-red-800';
                // ใช้ class btn-evaluate เพื่อให้เป็นสีน้ำเงิน
                buttonHtml = `<button onclick="openRemarkModal(${originalIndex})" class="btn-evaluate">ดูหมายเหตุ</button>`;
                break;
            case 'รอประเมิน':
                statusClass = 'bg-blue-100 text-blue-800';
                buttonHtml = `<button onclick="openEvaluationModal(${originalIndex})" class="btn-evaluate">ประเมินผลการสอบ</button>`;
                break;
            default:
                statusClass = 'bg-gray-100 text-gray-800';
        }

        const row = document.createElement('tr');
        row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${exam.project_th}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${formatDate(exam.start_date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${formatDate(exam.end_date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                            ${exam.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${buttonHtml}
                    </td>
                `;
        tableBody.appendChild(row);
    });
};

window.filterTable = () => {
    const selectedStatus = document.getElementById('status-filter').value;
    let filteredData = examData;

    if (selectedStatus !== 'all') {
        filteredData = examData.filter(exam => exam.status === selectedStatus);
    }

    renderTable(filteredData);
};

window.openEvaluationModal = (index) => {
    currentExamIndex = index;
    const exam = examData[currentExamIndex];

    if (!exam) return;

    document.getElementById('eval-project-th').textContent = exam.project_th;
    document.getElementById('eval-project-en').textContent = exam.project_en;
    document.getElementById('eval-start-date').textContent = formatDate(exam.start_date);
    document.getElementById('eval-end-date').textContent = formatDate(exam.end_date);

    const studentsDiv = document.getElementById('eval-students');
    studentsDiv.innerHTML = '';
    exam.students.forEach(student => {
        const p = document.createElement('p');
        p.innerHTML = `<strong class="text-gray-700">ชื่อ:</strong> ${student.name} (${student.id})`;
        studentsDiv.appendChild(p);
    });

    const committeeDiv = document.getElementById('eval-committee');
    committeeDiv.innerHTML = '';
    exam.committee.forEach(member => {
        const p = document.createElement('p');
        p.innerHTML = `<strong class="text-gray-700">ชื่อ:</strong> ${member.name} (<span class="font-bold text-blue-600">${member.role}</span>)`;
        committeeDiv.appendChild(p);
    });

    document.querySelectorAll('input[name="evaluation-status"]').forEach(radio => radio.checked = false);

    evaluationModal.style.display = 'flex';
};

window.openRemarkModal = (index) => {
    const exam = examData[index];
    if (!exam) return;

    document.getElementById('remark-project-name').textContent = exam.project_th;
    const commentsDiv = document.getElementById('remark-comments');
    commentsDiv.innerHTML = '';

    exam.committee.forEach(member => {
        const hasObjectiveRemark = member.objective_remark && member.objective_remark.trim() !== "";
        const hasScopeRemark = member.scope_remark && member.scope_remark.trim() !== "";

        if (hasObjectiveRemark || hasScopeRemark) {
            const card = document.createElement('div');
            card.className = 'p-4 rounded-lg border border-gray-200 bg-gray-50 mb-4';

            let cardContent = `
                        <p class="font-semibold text-gray-700 mb-2">ชื่อ: ${member.name} (${member.role})</p>
                    `;

            if (hasObjectiveRemark) {
                cardContent += `<div class="mb-2"><strong class="text-gray-600">หมายเหตุวัตถุประสงค์:</strong> <span class="text-gray-700">${member.objective_remark}</span></div>`;
            }

            if (hasScopeRemark) {
                cardContent += `<div><strong class="text-gray-600">หมายเหตุขอบเขต:</strong> <span class="text-gray-700">${member.scope_remark}</span></div>`;
            }

            card.innerHTML = cardContent;
            commentsDiv.appendChild(card);
        }
    });

    if (commentsDiv.innerHTML === '') {
        commentsDiv.innerHTML = `<div class="p-4 text-gray-500 text-center">ไม่มีหมายเหตุจากคณะกรรมการ</div>`;
    }

    remarkModal.style.display = 'flex';
};

window.closeModal = (modalId) => {
    document.getElementById(modalId).style.display = 'none';
};

window.submitEvaluation = () => {
    if (currentExamIndex === -1) return;

    const selectedStatus = document.querySelector('input[name="evaluation-status"]:checked');
    if (!selectedStatus) {
        alert('กรุณาเลือกสถานะการประเมิน');
        return;
    }

    const evaluationStatus = selectedStatus.value;

    const statusTextMap = {
        'pass': 'ผ่านการสอบหัวข้อโครงงาน',
        'revise': 'ผ่านแบบแก้ไข',
        'fail': 'ไม่ผ่านการสอบหัวข้อโครงงาน'
    };

    examData[currentExamIndex].status = statusTextMap[evaluationStatus];

    alert('ผลการประเมินเสร็จสิ้น ขอขอบคุณท่านคณะกรรมการเป็นอย่างสูง');

    closeModal('evaluationModal');
    filterTable();
    updateSummaryCards();
};

window.onclick = (event) => {
    if (event.target === evaluationModal) {
        closeModal('evaluationModal');
    }
    if (event.target === remarkModal) {
        closeModal('remarkModal');
    }
};

document.addEventListener('DOMContentLoaded', () => {
    updateSummaryCards();
    renderTable();
});
document.addEventListener('DOMContentLoaded', function() {
    // Get the sidebar and the open/close buttons
    const sidebar = document.getElementById('sidebar');
    const sidebarOpenBtn = document.getElementById('sidebar-open-btn'); // Add a button to open the sidebar
    const sidebarCloseBtn = document.getElementById('sidebar-close-btn');

    // Function to open the sidebar
    function openSidebar() {
        sidebar.classList.remove('-left-full'); // Or whichever class you use to hide it
        sidebar.classList.add('left-0');
    }

    // Function to close the sidebar
    function closeSidebar() {
        sidebar.classList.remove('left-0');
        sidebar.classList.add('-left-full'); // Or whichever class you use to hide it
    }

    // Add a click event to the close button
    if (sidebarCloseBtn) {
        sidebarCloseBtn.addEventListener('click', closeSidebar);
    }
    
    // Add a click event to an open button (you'll need to add this to your HTML)
    if (sidebarOpenBtn) {
        sidebarOpenBtn.addEventListener('click', openSidebar);
    }

    // แก้ไข: ปรับโค้ดการปิด sidebar เมื่อคลิกนอกพื้นที่
    // เพิ่มเงื่อนไขว่าโค้ดนี้จะทำงานเฉพาะบนหน้าจอขนาดเล็กกว่า 1024px เท่านั้น
    window.addEventListener('click', function(event) {
        if (window.innerWidth < 1024) { // ตรวจสอบขนาดหน้าจอ
            if (!sidebar.contains(event.target) && !event.target.closest('#sidebar-open-btn')) {
                closeSidebar();
            }
        }
    });

    // Add responsive behavior based on screen size
    function handleResize() {
        if (window.innerWidth >= 1024) { // Tailwind's 'lg' breakpoint
            sidebar.classList.remove('fixed', '-left-full');
            sidebar.classList.add('relative', 'left-0');
        } else {
            sidebar.classList.remove('relative', 'left-0');
            sidebar.classList.add('fixed', '-left-full');
        }
    }

    // Run on page load and on window resize
    handleResize();
    window.addEventListener('resize', handleResize);
});
